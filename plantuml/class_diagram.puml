@startuml
class ast.NodeTransformer {
    visit()
}

abstract class Handler {
    next : Handler
    {abstract} set_next(h: Handler)
    {abstract} handle(tree: ast.Module)
}
class ClassHandler {
    next : Handler
    set_next(h: Handler)
    handle(tree: ast.Module)
    visit_ClassDef(n: node)
}

class FunctionHandler {
    next : Handler
    set_next(h: Handler)
    handle(tree: ast.Module)
    visit_FunctionDef(n: node)
}

class VariableHandler{
    next : Handler
    set_next(h: Handler)
    handle(tree: ast.Module)
    visit_Assign(n: node)
}

class Obfuscator {
    chain : Handler
    storage: DefinitionStorage
    modules: list<ast.Module>
    initialize_chain()
    load_modules()
    gather_definitions()
    obfuscate()
}

class DefinitionTracker {
    definitions : dict
    is_defined(d: str)
    add_definition(d: str)
}

ast.NodeTransformer <|-- Handler
Handler <|-- ClassHandler
Handler "1" *-- ClassHandler
Handler <|-- FunctionHandler
Handler "1" *-- FunctionHandler
Handler <|-- VariableHandler
Handler "1" *-- VariableHandler
Obfuscator "1" *-- DefinitionTracker
Obfuscator "1" *-- Handler
@enduml
